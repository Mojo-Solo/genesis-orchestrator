# GENESIS UNIFIED CONFIGURATION
# Consolidated configuration for GENESIS Eval Spec System
# Generated by DevOps Integration + Security Enforcer Agents
# Date: 2025-01-20

# ==============================================
# CORE SYSTEM CONFIGURATION
# ==============================================
system:
  name: "GENESIS Orchestrator"
  version: "2.0"
  description: "Unified MCP Orchestrator with LAG/RCR integration"
  environment: "${GENESIS_ENV:-development}"

# ==============================================
# LAG + RCR ROUTING CONFIGURATION  
# ==============================================
routing:
  # Token Budget Management (RCR)
  token_budgets:
    beta_base: 512
    beta_role:
      # Core LAG Agents
      Planner: 1536
      Retriever: 1024
      Solver: 1024
      Critic: 1024
      Verifier: 1536
      Rewriter: 768
      
      # Extended Orchestrator Agents
      RevoExecutor: 2048
      BMADPlanner: 2048
      ClaudeScrumMaster: 1536
      Consult7: 2048
      Context7: 1536
      Serena: 1536
      CucumberBDD: 1024
      Playwright: 1024
      DatabaseManager: 1024
      SecurityMonitor: 1536
      MetaLearning: 2048

  # Importance Scoring (RCR)
  importance:
    signals: ["keyword_match", "role_keywords", "recency", "frequency", "relevance_score", "task_stage"]
    weights:
      keyword_match: 0.25
      role_keywords: 0.25  
      recency: 0.15
      frequency: 0.15
      relevance_score: 0.15
      task_stage: 0.05
    tie_breaker: "id"

  # Semantic Filtering (RCR)
  semantic_filter:
    enabled: true
    topk: 12
    # CRITICAL: Balanced threshold for 98.6% stability
    min_similarity: 0.55  # Compromise between 0.35 and 0.7
    embedding_model: "text-embedding-3-small"
    
  # Agent Categories & Routing
  agent_categories:
    deployment:
      priority: 1
      agents: ["ultimate_deployment_orchestrator", "deploy_agent"]
      keywords: ["deploy", "release", "rollout", "blue-green", "canary"]
    security:
      priority: 1  # Highest priority for security
      agents: ["security_monitoring", "security_compliance", "locksmith_auth_enforcer"]
      keywords: ["security", "auth", "vulnerability", "compliance", "audit", "scan"]
    intelligence:
      priority: 2
      agents: ["bmad_planner", "claude_scrum_master", "general_purpose"]
      keywords: ["plan", "design", "architecture", "sprint", "agile", "refactor"]
    monitoring:
      priority: 2
      agents: ["projectwe_monitoring", "infrastructure_monitoring"]
      keywords: ["monitor", "metrics", "alerts", "observability", "health"]
    testing:
      priority: 2
      agents: ["cucumber_bdd_architect", "playwright_agent", "testing_strategist"]
      keywords: ["test", "bdd", "e2e", "scenario", "coverage"]
    analysis:
      priority: 2
      agents: ["consult7_agent", "context7_agent", "serena_agent"]
      keywords: ["analyze", "review", "assess", "evaluate", "inspect"]
    automation:
      priority: 3
      agents: ["revo_executor", "desktop_commander"]
      keywords: ["automate", "generate", "code", "cli"]
    integration:
      priority: 3
      agents: ["db_manager", "api_designer"]
      keywords: ["database", "api", "integration", "migration", "sync"]
    meta_learning:
      priority: 3
      agents: ["meta_learning_engine"]
      keywords: ["optimize", "learn", "improve", "adapt", "performance"]

  # Routing Strategy
  strategies:
    primary: "intent_based"
    fallback: "keyword_matching"
    enable_parallel: true
    max_parallel_agents: 5

# ==============================================
# LAG (LOGICAL ANSWER GENERATION)
# ==============================================
lag_engine:
  enabled: true
  max_depth: 5
  max_steps: 27  # Fractal conversation limit
  cognitive_threshold: 0.8
  
  # Terminator Conditions (Critical for 98.6% stability)
  terminators:
    conditions:
      - "UNANSWERABLE"
      - "CONTRADICTION" 
      - "LOW_SUPPORT"
      - "DEPENDENCY_FAILURE"
      - "REDUNDANCY_DETECTED"
    confidence_threshold: 0.75
    max_retries: 2
    
  # Cartesian Decomposition
  decomposition:
    enable_when_cl_exceeds: 0.8  # Cognitive load threshold
    max_sub_questions: 9
    dependency_tracking: true
    logical_ordering: true

# ==============================================
# EXECUTION & PERFORMANCE
# ==============================================
execution:
  policies:
    max_retries: 3
    retry_backoff: "exponential"
    timeout_ms:
      default: 60000
      analysis: 120000
      deployment: 300000
      testing: 180000
      planning: 90000
      
  circuit_breaker:
    enabled: true
    failure_threshold: 5
    reset_timeout_ms: 60000
    
  # Quality Gates
  quality_gates:
    pre_execution:
      validate_context: true
      check_dependencies: true
      verify_permissions: true
      security_scan: true
    post_execution:
      validate_output: true
      check_errors: true
      verify_artifacts: true
      stability_check: true

# ==============================================
# STABILITY & REPRODUCIBILITY (98.6% TARGET)
# ==============================================
stability:
  target_percentage: 98.6
  measurement_window: 100  # Test runs
  deterministic_seed: 42
  max_temperature: 0.1
  variance_threshold: 0.014  # 1.4% max variance
  
  # Reproducibility Controls
  reproducibility:
    fixed_seeds: true
    deterministic_tool_mocks: true
    router_tie_break_by_id: true
    cache_embeddings: true
    idempotent_retries: true

# ==============================================
# SECURITY CONFIGURATION
# ==============================================
security:
  # Authentication & Authorization
  authentication:
    required: true
    provider: "clerk"  # Consolidated auth provider
    mfa_required_for_admin: true
    session_timeout_minutes: 120
    
  authorization:
    enabled: true
    rbac_enabled: true
    route_classification:
      public: []
      protected: ["*"]  # Default all protected
      admin: ["/admin/*", "/system/*"]
      
  # API Security
  api_security:
    rate_limiting:
      enabled: true
      requests_per_minute: 100
      burst_size: 20
    webhook_security:
      hmac_validation: true
      clock_skew_tolerance_seconds: 300
      idempotency_enabled: true
    input_validation:
      xss_protection: true
      sql_injection_prevention: true
      csrf_protection: true
      
  # Data Protection
  data_protection:
    pii_detection: true
    pii_redaction: true
    encryption_in_transit: true
    encryption_at_rest: true
    retention_windows_enforced: true
    
  # Audit & Compliance
  audit:
    enabled: true
    log_all_requests: true
    pii_access_logging: true
    retention_years: 7

# ==============================================
# MONITORING & OBSERVABILITY
# ==============================================
monitoring:
  enabled: true
  
  # Metrics Collection
  metrics:
    enabled: true
    export_interval_seconds: 30
    retention_days: 7
    sampling_rate: 1.0
    
  # Distributed Tracing  
  tracing:
    enabled: true
    trace_all_requests: true
    trace_lag_steps: true
    trace_rcr_routing: true
    
  # Health Checks
  health_checks:
    agent_health:
      interval_seconds: 30
      timeout_ms: 5000
      unhealthy_threshold: 3
      healthy_threshold: 2
    system_health:
      database_connectivity: true
      external_service_health: true
      memory_usage_threshold: 0.85
      cpu_usage_threshold: 0.80

# ==============================================
# META-LEARNING & OPTIMIZATION
# ==============================================
meta_learning:
  enabled: true
  learning_rate: 0.01
  batch_size: 50
  update_interval_minutes: 60
  
  # Performance Metrics Tracking
  performance_metrics:
    - accuracy
    - latency  
    - token_usage
    - success_rate
    - stability_score
    
  # Optimization Targets
  optimization_targets:
    latency_reduction: 0.10      # 10% reduction target
    accuracy_improvement: 0.02   # 2% improvement target  
    token_efficiency: 0.05       # 5% token reduction target
    stability_improvement: 0.001 # 0.1% stability improvement

# ==============================================
# ARTIFACT GENERATION (EVALUATION REQUIRED)
# ==============================================
artifacts:
  enabled: true
  output_directory: "./artifacts"
  
  # Required Evaluation Artifacts
  required:
    - "preflight_plan.json"      # LAG planning output
    - "execution_trace.ndjson"   # Complete execution trace
    - "memory_pre.json"          # Memory state before
    - "memory_post.json"         # Memory state after
    - "router_metrics.json"      # RCR performance metrics
    - "meta_report.md"           # Self-analysis report
    - "acceptance.json"          # Evaluation results
    - "sbom.json"               # Software bill of materials
    - "policy.json"             # Security and privacy policies
    - "redteam.md"              # Security testing results
    
  # Artifact Configuration
  generation:
    auto_generate: true
    include_run_id: true
    include_correlation_id: true
    include_timestamps: true
    compress_large_artifacts: true

# ==============================================
# ENVIRONMENT-SPECIFIC OVERRIDES
# ==============================================
environments:
  development:
    stability:
      target_percentage: 95.0  # Relaxed for development
    monitoring:
      sampling_rate: 0.1      # Reduced sampling
    security:
      mfa_required_for_admin: false
      
  staging:
    stability:
      target_percentage: 97.0  # Staging validation
    monitoring:
      retention_days: 3
      
  production:
    stability:
      target_percentage: 98.6  # Full production target
    security:
      audit:
        log_all_requests: true
        pii_access_logging: true
    monitoring:
      retention_days: 30

# ==============================================
# EXTERNAL INTEGRATIONS
# ==============================================
integrations:
  # Vector Storage
  pinecone:
    enabled: true
    namespace_isolation: true
    dimension: 1536
    
  # AI/ML Services
  openai:
    enabled: true
    models:
      embedding: "text-embedding-3-small"
      completion: "gpt-4"
    rate_limits:
      requests_per_minute: 500
      tokens_per_minute: 150000
      
  # Transcription & Analysis
  fireflies:
    enabled: true
    auto_transcription: true
    ai_analysis_enabled: true
    
  # Message Queuing & Caching
  redis:
    enabled: true
    use_for_caching: true
    use_for_queues: true
    key_prefix: "genesis:"
    
# ==============================================
# DEPLOYMENT CONFIGURATION
# ==============================================
deployment:
  strategy: "blue_green"
  rollback_enabled: true
  health_check_path: "/health/ready"
  readiness_probe: "/health/ready"
  liveness_probe: "/health/live"
  
  # Resource Requirements
  resources:
    memory_request: "512Mi"
    memory_limit: "2Gi"
    cpu_request: "250m"
    cpu_limit: "1000m"
    
  # Auto-scaling
  autoscaling:
    enabled: true
    min_replicas: 2
    max_replicas: 10
    target_cpu_utilization: 70
    target_memory_utilization: 80