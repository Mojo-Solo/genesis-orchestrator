{{ define "__subject" }}
[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join " " }}{{ end }}){{ end }}
{{ end }}

{{ define "__description" }}{{ end }}

{{ define "__text_alert_list" }}{{ range . }}
{{ if .Labels.alertname }}**Alert:** {{ .Labels.alertname }}{{ end }}
{{ if .Annotations.summary }}**Summary:** {{ .Annotations.summary }}{{ end }}
{{ if .Annotations.description }}**Description:** {{ .Annotations.description }}{{ end }}
{{ if .Labels.component }}**Component:** {{ .Labels.component }}{{ end }}
{{ if .Labels.severity }}**Severity:** {{ .Labels.severity }}{{ end }}
{{ if .Labels.instance }}**Instance:** {{ .Labels.instance }}{{ end }}
{{ if .Annotations.runbook_url }}**Runbook:** {{ .Annotations.runbook_url }}{{ end }}
**Started:** {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}
{{ if .EndsAt }}**Ended:** {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}{{ end }}
---
{{ end }}{{ end }}

{{ define "slack.title" }}
{{ if eq .Status "firing" }}ðŸ”¥ FIRING{{ else }}âœ… RESOLVED{{ end }} - {{ .GroupLabels.alertname }}
{{ end }}

{{ define "slack.text" }}
{{ if eq .Status "firing" }}
**{{ .Alerts.Firing | len }} alert(s) firing:**
{{ template "__text_alert_list" .Alerts.Firing }}
{{ end }}
{{ if eq .Status "resolved" }}
**{{ .Alerts.Resolved | len }} alert(s) resolved:**
{{ template "__text_alert_list" .Alerts.Resolved }}
{{ end }}
{{ end }}

{{ define "slack.color" }}
{{ if eq .Status "firing" }}
  {{ if eq .CommonLabels.severity "critical" }}danger{{ else }}warning{{ end }}
{{ else }}good{{ end }}
{{ end }}

{{ define "email.subject" }}
{{ template "__subject" . }}
{{ end }}

{{ define "email.html" }}
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Genesis Orchestrator Alert</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .alert { border-left: 4px solid #ff6b6b; padding: 15px; margin: 10px 0; background: #fff5f5; }
    .critical { border-color: #ff0000; background: #ffe0e0; }
    .warning { border-color: #ffa500; background: #fff8e1; }
    .resolved { border-color: #4caf50; background: #f1f8e9; }
    .header { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
    .meta { font-size: 12px; color: #666; margin-top: 10px; }
    .runbook { background: #e3f2fd; padding: 10px; margin: 10px 0; border-radius: 4px; }
  </style>
</head>
<body>
  <h1>Genesis Orchestrator Alert Notification</h1>
  
  {{ if eq .Status "firing" }}
  <div class="header" style="color: #d32f2f;">ðŸ”¥ {{ .Alerts.Firing | len }} Alert(s) Firing</div>
  {{ range .Alerts.Firing }}
  <div class="alert {{ .Labels.severity }}">
    <h3>{{ .Labels.alertname }}</h3>
    <p><strong>Summary:</strong> {{ .Annotations.summary }}</p>
    <p><strong>Description:</strong> {{ .Annotations.description }}</p>
    <p><strong>Component:</strong> {{ .Labels.component }}</p>
    <p><strong>Severity:</strong> {{ .Labels.severity }}</p>
    {{ if .Labels.instance }}<p><strong>Instance:</strong> {{ .Labels.instance }}</p>{{ end }}
    {{ if .Annotations.runbook_url }}
    <div class="runbook">
      <strong>Runbook:</strong> <a href="{{ .Annotations.runbook_url }}">{{ .Annotations.runbook_url }}</a>
    </div>
    {{ end }}
    <div class="meta">Started: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}</div>
  </div>
  {{ end }}
  {{ end }}
  
  {{ if eq .Status "resolved" }}
  <div class="header" style="color: #388e3c;">âœ… {{ .Alerts.Resolved | len }} Alert(s) Resolved</div>
  {{ range .Alerts.Resolved }}
  <div class="alert resolved">
    <h3>{{ .Labels.alertname }}</h3>
    <p><strong>Summary:</strong> {{ .Annotations.summary }}</p>
    <div class="meta">
      Started: {{ .StartsAt.Format "2006-01-02 15:04:05 UTC" }}<br>
      Resolved: {{ .EndsAt.Format "2006-01-02 15:04:05 UTC" }}
    </div>
  </div>
  {{ end }}
  {{ end }}
  
  <hr>
  <p style="font-size: 12px; color: #666;">
    This alert was generated by Genesis Orchestrator monitoring system.<br>
    For more information, visit the <a href="http://grafana.genesis.ai">monitoring dashboard</a>.
  </p>
</body>
</html>
{{ end }}

{{ define "pagerduty.description" }}
{{ .GroupLabels.alertname }}: {{ range .Alerts.Firing }}{{ .Annotations.summary }}{{ end }}
{{ end }}

{{ define "webhook.title" }}
{{ if eq .Status "firing" }}FIRING{{ else }}RESOLVED{{ end }}: {{ .GroupLabels.alertname }}
{{ end }}

{{ define "webhook.message" }}
{
  "status": "{{ .Status }}",
  "alerts": [
    {{ range $i, $alert := .Alerts }}
    {{ if $i }},{{ end }}
    {
      "alertname": "{{ $alert.Labels.alertname }}",
      "summary": "{{ $alert.Annotations.summary }}",
      "description": "{{ $alert.Annotations.description }}",
      "severity": "{{ $alert.Labels.severity }}",
      "component": "{{ $alert.Labels.component }}",
      "instance": "{{ $alert.Labels.instance }}",
      "starts_at": "{{ $alert.StartsAt.Format "2006-01-02T15:04:05Z07:00" }}",
      "ends_at": "{{ if $alert.EndsAt }}{{ $alert.EndsAt.Format "2006-01-02T15:04:05Z07:00" }}{{ end }}",
      "runbook_url": "{{ $alert.Annotations.runbook_url }}"
    }
    {{ end }}
  ],
  "group_labels": {{ .GroupLabels | json }},
  "common_labels": {{ .CommonLabels | json }},
  "external_url": "{{ .ExternalURL }}"
}
{{ end }}